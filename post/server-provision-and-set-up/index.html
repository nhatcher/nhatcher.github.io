<!doctype html><html dir=ltr lang=en data-theme class="html theme--light"><head>
<title>
Nicolás Hatcher
|
Server Provision and Set Up
</title>
<meta charset=utf-8><meta name=generator content="Hugo 0.122.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name=author content="Nicolás Hatcher">
<meta name=description content="Software developer by trade, physicist by soul">
<link rel=stylesheet href=/scss/main.min.1147aa5bacb4bce677a0e264073829caedb82fd18ea07a5f1d80521f539d1c45.css integrity="sha256-EUeqW6y0vOZ3oOJkBzgpyu24L9GOoHpfHYBSH1OdHEU=" crossorigin=anonymous type=text/css>
<link rel=stylesheet href=/css/markupHighlight.min.73ccfdf28df555e11009c13c20ced067af3cb021504cba43644c705930428b00.css integrity="sha256-c8z98o31VeEQCcE8IM7QZ688sCFQTLpDZExwWTBCiwA=" crossorigin=anonymous type=text/css>
<link rel=stylesheet href=/fontawesome/css/fontawesome.min.7d272de35b410fb165377550cdf9c4d3a80fbbcc961e111914e4d5c0eaf5729f.css integrity="sha256-fSct41tBD7FlN3VQzfnE06gPu8yWHhEZFOTVwOr1cp8=" crossorigin=anonymous type=text/css>
<link rel=stylesheet href=/fontawesome/css/solid.min.55d8333481b07a08e07cf6f37319753a2b47e99f4c395394c5747b48b495aa9b.css integrity="sha256-VdgzNIGwegjgfPbzcxl1OitH6Z9MOVOUxXR7SLSVqps=" crossorigin=anonymous type=text/css>
<link rel=stylesheet href=/fontawesome/css/regular.min.a7448d02590b43449364b6b5922ed9af5410abb4de4238412a830316dedb850b.css integrity="sha256-p0SNAlkLQ0STZLa1ki7Zr1QQq7TeQjhBKoMDFt7bhQs=" crossorigin=anonymous type=text/css>
<link rel=stylesheet href=/fontawesome/css/brands.min.9ed75a5d670c953fe4df935937674b4646f92674367e9e66eb995bb04e821647.css integrity="sha256-ntdaXWcMlT/k35NZN2dLRkb5JnQ2fp5m65lbsE6CFkc=" crossorigin=anonymous type=text/css>
<link rel="shortcut icon" href=/favicons/favicon.ico type=image/x-icon>
<link rel=apple-touch-icon sizes=180x180 href=/favicons/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicons/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicons/favicon-16x16.png>
<link rel=canonical href=https://www.nhatcher.com/post/server-provision-and-set-up/>
<script type=text/javascript src=/js/anatole-header.min.f9132794301a01ff16550ed66763482bd848f62243d278f5e550229a158bfd32.js integrity="sha256-+RMnlDAaAf8WVQ7WZ2NIK9hI9iJD0nj15VAimhWL/TI=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/anatole-theme-switcher.min.d6d329d93844b162e8bed1e915619625ca91687952177552b9b3e211014a2957.js integrity="sha256-1tMp2ThEsWLovtHpFWGWJcqRaHlSF3VSubPiEQFKKVc=" crossorigin=anonymous></script>
<meta name=twitter:card content="summary"><meta name=twitter:title content="Server Provision and Set Up">
<meta name=twitter:description content="How to provision a set up a server for a web application WARNING: Work in progress">
<meta property="og:title" content="Server Provision and Set Up">
<meta property="og:description" content="How to provision a set up a server for a web application WARNING: Work in progress">
<meta property="og:type" content="article">
<meta property="og:url" content="https://www.nhatcher.com/post/server-provision-and-set-up/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2021-12-19T23:46:46+01:00">
<meta property="article:modified_time" content="2021-12-19T23:46:46+01:00"><meta property="og:site_name" content="I'm Nicolás Hatcher">
<script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"post","name":"Server Provision and Set Up","headline":"Server Provision and Set Up","alternativeHeadline":"","description":"
      
        How to provision a set up a server for a web application WARNING: Work in progress


      


    ","inLanguage":"en","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.nhatcher.com\/post\/server-provision-and-set-up\/"},"author":{"@type":"Person","name":"Nicolás Hatcher"},"creator":{"@type":"Person","name":"Nicolás Hatcher"},"accountablePerson":{"@type":"Person","name":"Nicolás Hatcher"},"copyrightHolder":{"@type":"Person","name":"Nicolás Hatcher"},"copyrightYear":"2021","dateCreated":"2021-12-19T23:46:46.00Z","datePublished":"2021-12-19T23:46:46.00Z","dateModified":"2021-12-19T23:46:46.00Z","publisher":{"@type":"Organization","name":"Nicolás Hatcher","url":"https://www.nhatcher.com","logo":{"@type":"ImageObject","url":"https:\/\/www.nhatcher.com\/favicons\/favicon-32x32.png","width":"32","height":"32"}},"image":[],"url":"https:\/\/www.nhatcher.com\/post\/server-provision-and-set-up\/","wordCount":"1293","genre":[],"keywords":[]}</script>
</head>
<body class=body>
<div class=wrapper>
<aside class=wrapper__sidebar><div class="sidebar
.">
<div class=sidebar__content>
<div class=sidebar__introduction>
<img class=sidebar__introduction-profileimage src=/images/profile.jpg alt="profile picture">
<div class=sidebar__introduction-title>
<a href=/>I'm Nicolás Hatcher</a>
</div>
<div class=sidebar__introduction-description>
<p>Software developer by trade, physicist by soul</p>
</div>
</div>
<ul class=sidebar__list>
<li class=sidebar__list-item>
<a href="https://arxiv.org/search/?searchtype=author&amp;query=Hatcher%2C+N" target=_blank rel="noopener me" aria-label=Publications title=Publications>
<i class="fas fa-file-alt fa-2x" aria-hidden=true></i>
</a>
</li>
<li class=sidebar__list-item>
<a href=https://github.com/nhatcher/ target=_blank rel="noopener me" aria-label=GitHub title=GitHub>
<i class="fab fa-github fa-2x" aria-hidden=true></i>
</a>
</li>
<li class=sidebar__list-item>
<a href=https://www.instagram.com/theuniverse.today target=_blank rel="noopener me" aria-label=instagram title=instagram>
<i class="fab fa-instagram fa-2x" aria-hidden=true></i>
</a>
</li>
<li class=sidebar__list-item>
<a href=mailto:nicolas@theuniverse.today target=_blank rel="noopener me" aria-label=e-mail title=e-mail>
<i class="fas fa-envelope fa-2x" aria-hidden=true></i>
</a>
</li>
</ul>
</div><footer class="footer footer__sidebar">
<ul class=footer__list>
<li class=footer__item>
&copy;
Nicolás Hatcher
2024
</li>
</ul>
</footer>
<script type=text/javascript src=/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ=" crossorigin=anonymous></script></div>
</aside>
<main class=wrapper__main>
<header class=header><div class=.>
<a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false>
<span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span>
</a>
<nav class=nav>
<ul class=nav__list id=navMenu>
<li class=nav__list-item>
<a href=/ title>Home</a>
</li>
<li class=nav__list-item>
<a href=/post/ title>Posts</a>
</li>
<li class=nav__list-item>
<a href=/about/ title>About</a>
</li>
</ul>
<ul class="nav__list nav__list--end">
<li class=nav__list-item>
<div class=themeswitch>
<a title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a>
</div>
</li>
</ul>
</nav>
</div>
</header>
<div class="post
.">
<div class=post__content>
<h1>Server Provision and Set Up</h1>
<ul class=post__meta>
<li class=post__meta-item>
<em class="fas fa-calendar-day post__meta-icon"></em>
<span class=post__meta-text>
Sun, Dec 19, 2021
</span>
</li>
<li class=post__meta-item>
<em class="fas fa-stopwatch post__meta-icon"></em>
<span class=post__meta-text>7-minute read</span>
</li>
</ul>
<h1 id=how-to-provision-a-set-up-a-server-for-a-web-application>How to provision a set up a server for a web application</h1>
<p>WARNING: Work in progress</p>
<p>Once you have a web application you will need to deploy it to a server. You will learn here how to do that.
This is for you if you have a small web application that connects to a database of sorts and has to serve dynamic content.
Here you will learn in it&rsquo;s simplest form how to take that application and deploy it in the internet. Give it a URL, make it secure and even get an email associated to your service.</p>
<p>If you want a landing page, a blog or just your home page there are simpler and almost free ways of doing it.</p>
<p>There are are only two things you will need to pay for:</p>
<ul>
<li>Hosting (&lt;10$/monthly)</li>
<li>Domain Name (~10$/year)</li>
</ul>
<h2 id=providers>Providers</h2>
<p>The first thing you need is a computer were your application is running. That comes with the name of a VPS (Virtual Personal Server).
You could host it yourself if you can have a computer permanently connected to the internet.
I will show you how to do that some other time, here today we will pay for the service.</p>
<p>There are many good companies that offer a good service for 5 to 10 € a month.
Some I have tried:</p>
<ul>
<li><a href=https://www.scaleway.com/en/>Scaleway</a></li>
<li><a href=https://www.digitalocean.com/>Digital Ocean</a></li>
<li><a href=https://www.linode.com/>Linode</a></li>
<li><a href=https://www.hetzner.com/>Hetzner</a></li>
<li><a href=https://www.hostinger.com/vps-hosting>Hostinger</a></li>
</ul>
<p>Remember to set the ssh keys and get an Unbuntu instance.</p>
<h2 id=secure-server>Secure server</h2>
<p>Note on terminology. We will assume that the user in our account is <code>John Smith</code>, their user name is <code>jsmith</code>,
their website is <code>http://www.example.com</code> and their ip <code>93.184.216.34</code>.</p>
<p>Once the server is provisioned we can ssh into it:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jsmith@my_computer:~/$ ssh root@93.184.216.34
</span></span></code></pre></div><p>First thing we do is install fail2ban:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@93.184.216.34:~# apt install fail2ban
</span></span></code></pre></div><h3 id=user-administration>User administration.</h3>
<p>The first thing we are going to do is to create users and grant them sudo access.</p>
<p>Add user and create bash, home folder, etc:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@93.184.216.34:~# adduser jsmith
</span></span></code></pre></div><p>You will need to add a temporary password for the user. If you are the user, then you don&rsquo;t need to change the password afterwards.
Otherwise communicate the user the password in a secure manner.</p>
<p>Add the user to the sudoers list</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>root@93.184.216.34:~# usermod -aG sudo jsmith
</span></span></code></pre></div><p>Create authorized_keys so they can ssh without passwords</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@93.184.216.34:~# su jsmith
</span></span><span class=line><span class=cl>jsmith@93.184.216.34:/root$ <span class=nb>cd</span> /home/jsmith/
</span></span><span class=line><span class=cl>jsmith@93.184.216.34:~$ mkdir .ssh
</span></span><span class=line><span class=cl>jsmith@93.184.216.34:~$ chmod <span class=m>700</span> .ssh/
</span></span><span class=line><span class=cl>jsmith@93.184.216.34:~$ <span class=nb>cd</span> .ssh
</span></span><span class=line><span class=cl>jsmith@93.184.216.34:~$ touch authorized_keys
</span></span><span class=line><span class=cl>jsmith@93.184.216.34:~$ chmod <span class=m>700</span> authorized_keys
</span></span></code></pre></div><p>And copy the users public (id_rsa.pub) in the file. Using vim or nano.</p>
<p>Then form the remote computer you should be able to ssh without a password:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jsmith@my_computer:~/$ ssh root@93.184.216.34
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>jsmith@93.184.216.34:~$
</span></span></code></pre></div><p>They should change their password</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>jsmith@93.184.216.34:~$ passwrd
</span></span></code></pre></div><p>Repeat for any superuser in the system.</p>
<h3 id=firewall>Firewall</h3>
<p>WARNING: Be very careful in this section, if you make a mistake you can lock yourself out permanently from the computer.</p>
<p>In this section we are going to setup a <em>firewall</em>. That&rsquo;s basically a simple way for blocking traffic.
This is a bit of a complicated issue. The still standard way of doing it in Linux is with a program called <code>iptables</code>. That&rsquo;s a bit too complex for a beginner and there are a couple of programs that will simplify your life while using iptables in the background. Two I have used are <em>firehol</em> and <em>ufw</em>. We will use here the later (although I actually use the former in most situations).</p>
<p>Install the <em>uncomplicated firewall</em> and make sure it is disabled.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@93.184.216.34:~# apt install ufw
</span></span><span class=line><span class=cl>root@93.184.216.34:~# ufw disable
</span></span></code></pre></div><p>We will:</p>
<ul>
<li>reset all rules</li>
<li>deny all incoming traffic</li>
<li>allow all outgoing traffic</li>
<li>allow all traffic for ssh (port 22), http (port 80) and https (port 443)</li>
</ul>
<p>We run the commands:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@93.184.216.34:~# ufw default deny incoming
</span></span><span class=line><span class=cl>root@93.184.216.34:~# ufw default allow outgoing
</span></span><span class=line><span class=cl>root@93.184.216.34:~# ufw allow ssh
</span></span><span class=line><span class=cl>root@93.184.216.34:~# ufw allow http
</span></span><span class=line><span class=cl>root@93.184.216.34:~# ufw allow https
</span></span></code></pre></div><p>Finally enable the firewall:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@93.184.216.34:~# ufw <span class=nb>enable</span>
</span></span></code></pre></div><p>NOTES: Even iptables is outdated it&rsquo;s successor since 2014, <em>nftables</em> is still not widely used. They both (iptables and nftables) run on the top of a kernel space program called <em>netfilter</em>. How all this works is something for a later (more theoretical and interesting post).</p>
<h2 id=logs>Logs</h2>
<p>You can find logs in&mldr;</p>
<h2 id=webserver-and-the-application-servers>Webserver and the Application Servers</h2>
<p>If you have build your web application you probably run it on your local machine in some port with some command.
It might be python, node js, go,&mldr; any language. Some times you might need to run more than one of those to have the application running.
I call those the <em>application server</em>. Depending a bit on your development environment they might <em>not</em> be production ready.
For instance, many people like their webpages to reload <em>automatically</em> whenever there is a file change. That&rsquo;s definitely not fine for production purposes (both the application server and the javascript build). Simple python servers like bottle or django are not ready to be deployed on production.
What is the right application sever for your particular case it is difficult for me to say, it depends on your programming language and your stack.
In general if you are working with python you might want to use <a href=https://gunicorn.org/>Gunicorn</a> or <a href=https://uwsgi-docs.readthedocs.io/en/latest/>uWSGI</a>. If you are working with node the famous <em>express</em> might be production ready. A simple server written in the <em>go</em> programming language might need nothing else.</p>
<p>But even when you have selected that, the application server might benefit a lot for a professional <em>webserver</em> sitting in front.
The webserver can do everything that is language agnostic and that does not need to be repeated for every language and framework. Things like compress files, do the SSL, route general traffic, cache files. The webserver can also help serving static files like javascript, html, css or images. In general the webserver will sit in front, being the first (after the firewall, of course) in getting all the traffic directed towards your computer and it will be up to it what to do with the request, route it to some other service or act by serving a static asset. The webserver takes care of so many other things you probably don&rsquo;t want to think about like slow clients, lost of request coming at the same time, dealing with wrong requests. And even beyond, the webserver can be used as a load balancer, manipulate response headers, doing access control and security checks, fetching storage backends to decide where to route a request,&mldr; List is probably endless.</p>
<p>There many fine and battle tested webservers. Three I have used extensively are: <a href=https://httpd.apache.org/>Apache</a>, <a href=https://www.nginx.com/>nginx</a> and <a href=https://caddyserver.com/>Caddy</a>.</p>
<p>My personal favourite is Caddy, but we will use nginx this time around. I do not use Apache anymore, but it is a fine choice.</p>
<p>Before anything you should make sure there is not a webserver already installed in your system. A simple test would be to visit your ip address <code>https://93.184.216.34/</code>.
If there is a webserver already installed you should remove it first. It is most likely the Apache webserver.</p>
<p>First let&rsquo;s install nginx and serve some static content.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@93.184.216.34:~# apt install nginx
</span></span><span class=line><span class=cl>root@93.184.216.34:~# service start nginx
</span></span></code></pre></div><p>Now if you visit your ip address you should find the default nginx greeting page.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>location</span> <span class=o>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1># First attempt to serve request as file, then</span>
</span></span><span class=line><span class=cl>        <span class=c1># as directory, then fall back to displaying a 404.</span>
</span></span><span class=line><span class=cl>        <span class=n>try_files</span> <span class=o>$</span><span class=n>uri</span> <span class=o>$</span><span class=n>uri</span><span class=o>/</span> <span class=o>=</span><span class=mi>404</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>root</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>html</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>location</span> <span class=o>/</span><span class=n>api</span><span class=o>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>proxy_set_header</span> <span class=n>Host</span> <span class=o>$</span><span class=n>host</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=c1># proxy_set_header X-Real-IP $remote_addr;</span>
</span></span><span class=line><span class=cl>        <span class=n>proxy_pass</span> <span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=mf>127.0</span><span class=o>.</span><span class=mf>0.1</span><span class=p>:</span><span class=mi>8080</span><span class=o>/</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=services>Services</h2>
<p>We will first create an underprivileged user to run the web application.
We created some normal users before, with <code>home</code> and added them to the sudoers list. We are going to go the opposite way here.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># vim /lib/systemd/system/my_app.service</span>
</span></span></code></pre></div><p>Example service</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>[</span><span class=n>Unit</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>Description</span><span class=o>=</span><span class=n>My</span> <span class=n>description</span> <span class=n>of</span> <span class=n>the</span> <span class=n>app</span>
</span></span><span class=line><span class=cl><span class=n>Documentation</span><span class=o>=</span><span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>example</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>documentation</span>
</span></span><span class=line><span class=cl><span class=n>After</span><span class=o>=</span><span class=n>network</span><span class=o>.</span><span class=n>target</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>Service</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>Type</span><span class=o>=</span><span class=n>simple</span>
</span></span><span class=line><span class=cl><span class=n>User</span><span class=o>=</span><span class=n>node</span>
</span></span><span class=line><span class=cl><span class=n>WorkingDirectory</span><span class=o>=/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>server</span>
</span></span><span class=line><span class=cl><span class=n>ExecStart</span><span class=o>=/</span><span class=n>opt</span><span class=o>/</span><span class=n>node</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>node</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>server</span><span class=o>/</span><span class=n>index</span><span class=o>.</span><span class=n>js</span>
</span></span><span class=line><span class=cl><span class=n>Restart</span><span class=o>=</span><span class=n>always</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>Install</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>WantedBy</span><span class=o>=</span><span class=n>multi</span><span class=o>-</span><span class=n>user</span><span class=o>.</span><span class=n>target</span>
</span></span></code></pre></div><p>To start it</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># service my app start</span>
</span></span></code></pre></div><h2 id=domain-names>Domain names</h2>
<p>Namecheap</p>
<h2 id=certificates>Certificates</h2>
<p>Let&rsquo;s encrypt</p>
<h2 id=getting-email>Getting email</h2>
<p>Zoho</p>
</div>
<div class=post__footer>
</div>
<div id=comment>
<h2>comments</h2>
<script src=https://utteranc.es/client.js repo=nhatcher/nhatcher.github.io issue-term=pathname theme=preferred-color-scheme crossorigin=anonymous async></script>
</div>
</div>
</main>
</div><footer class="footer footer__base">
<ul class=footer__list>
<li class=footer__item>
&copy;
Nicolás Hatcher
2024
</li>
</ul>
</footer>
<script type=text/javascript src=/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ=" crossorigin=anonymous></script></body>
</html>